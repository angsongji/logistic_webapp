<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head"></head>
<style th:replace="fragments/sidebar_accountant :: sidebar-styles"></style>
<body class="bg-light">

<nav th:replace="fragments/header :: navbar"></nav>

<!-- Sidebar -->
<div th:replace="fragments/sidebar_accountant :: sidebar-accountant"></div>

<!-- Main Content -->
<div class="main-content-with-sidebar">
    <div class="container-fluid p-4">
        <h3 class="mb-4">üí≥ Danh s√°ch thanh to√°n</h3>

<table class="table table-hover">
    <thead>
    <tr class="table-primary text-center">
        <th>ID</th>
        <th>ƒê∆°n h√†ng</th>
        <th>S·ªë ti·ªÅn</th>
        <th>Ph∆∞∆°ng th·ª©c</th>
        <th>Tr·∫°ng th√°i</th>
        <th>Thao t√°c</th>
    </tr>
    </thead>
    <tbody id="payments-table"></tbody>
</table>

<script>
    async function loadPayments() {
        const res = await fetch('/api/accountant/payments', {
            credentials: 'include'
        });
        const data = await res.json();
        const tbody = document.getElementById('payments-table');
        tbody.innerHTML = data.map(p =>
            `<tr>
                <td>${p.id}</td>
                <td>${p.orderId}</td>
                <td>${p.amount}</td>
                <td>${p.method}</td>
                <td>${p.status}</td>
                <td>
                    <button class='btn btn-success btn-sm' onclick='confirm(${p.id})'>‚úî</button>
                    <button class='btn btn-danger btn-sm' onclick='refund(${p.id})'>‚Ü©</button>
                </td>
            </tr>`).join('');
    }

    async function confirm(id) {
        await fetch(`/api/accountant/payments/${id}/confirm`, {
            method: 'POST',
            credentials: 'include'
        });
        alert('ƒê√£ x√°c nh·∫≠n thanh to√°n');
        loadPayments();
    }

    async function refund(id) {
        await fetch(`/api/accountant/payments/${id}/refund`, {
            method: 'POST',
            credentials: 'include'
        });
        alert('ƒê√£ ho√†n ti·ªÅn');
        loadPayments();
    }

    loadPayments();
</script>
    </div>
</div>

<footer th:replace="fragments/footer :: footer"></footer>

<!-- Sidebar Script -->
<script th:replace="fragments/sidebar_accountant :: sidebar-script"></script>

</body>
</html>
