<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head"></head>
<body class="bg-light">

<nav th:replace="fragments/header :: navbar"></nav>

<!-- Profile & Password Modals -->
<div th:replace="fragments/header :: profile-modal"></div>
<div th:replace="fragments/header :: password-modal"></div>

<div class="container mt-4">
    <h3 class="mb-3">üîé Tra c·ª©u ƒë∆°n h√†ng</h3>

    <div class="row g-2 mb-3">
        <div class="col-auto">
            <input id="orderCode" class="form-control" placeholder="Nh·∫≠p m√£ ƒë∆°n h√†ng" />
        </div>
        <div class="col-auto">
            <button id="btnTrack" class="btn btn-primary">Xem tr·∫°ng th√°i</button>
        </div>
    </div>

    <div id="result" class="card d-none">
        <div class="card-body">
            <div class="mb-2"><b>M√£ ƒë∆°n:</b> <span id="resCode"></span></div>
            <div class="mb-2"><b>Tr·∫°ng th√°i:</b> <span id="resStatus" class="badge bg-info"></span></div>
            <div class="mb-2"><b>Ng∆∞·ªùi nh·∫≠n:</b> <span id="resRecipient"></span></div>
            <div class="mb-2"><b>Ng√†y t·∫°o:</b> <span id="resCreated"></span></div>
            <div id="resImageWrap" class="mt-3 d-none">
                <img id="resImage" src="" alt="H√¨nh ·∫£nh ƒë∆°n h√†ng" class="img-fluid rounded border" />
            </div>
        </div>
    </div>

    <div id="alert" class="alert alert-warning d-none mt-3"></div>
</div>

<script>
    document.getElementById('btnTrack').addEventListener('click', async () => {
        const code = document.getElementById('orderCode').value?.trim();
        const alertBox = document.getElementById('alert');
        const result = document.getElementById('result');
        if (!code) {
            alertBox.textContent = 'Vui l√≤ng nh·∫≠p m√£ ƒë∆°n h√†ng';
            alertBox.classList.remove('d-none');
            result.classList.add('d-none');
            return;
        }

        try {
            alertBox.classList.add('d-none');
            const res = await fetch(`/api/customer/orders/${code}/tracking`, {
                credentials: 'include'
            });
            if (!res.ok) throw new Error('Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng');
            const o = await res.json();
            document.getElementById('resCode').textContent = o.orderCode || code;
            document.getElementById('resStatus').textContent = o.status || 'N/A';
            document.getElementById('resRecipient').textContent = o.recipientName || '';
            document.getElementById('resCreated').textContent = (o.createdAt || '').replace('T', ' ');
            if (o.imageUrl) {
                document.getElementById('resImage').src = o.imageUrl;
                document.getElementById('resImageWrap').classList.remove('d-none');
            } else {
                document.getElementById('resImageWrap').classList.add('d-none');
            }
            result.classList.remove('d-none');
        } catch (e) {
            alertBox.textContent = e.message || 'L·ªói khi truy v·∫•n tr·∫°ng th√°i ƒë∆°n h√†ng';
            alertBox.classList.remove('d-none');
            result.classList.add('d-none');
        }
    });
</script>
</div>

<footer th:replace="fragments/footer :: footer"></footer>

<!-- Profile Script -->
<script th:replace="fragments/header :: profile-script"></script>

</body>
</html>